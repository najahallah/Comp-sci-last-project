<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
        <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>

    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDPVuZdO4O1SCO6qY1-_KYoF42f_1frUOE",
            authDomain: "assassin-a488d.firebaseapp.com",
            databaseURL: "https://assassin-a488d.firebaseio.com",
            storageBucket: "assassin-a488d.appspot.com",
        };
        firebase.initializeApp(config);

        function userNotInDb(user) {

            firebase.database().ref('users/' + user.uid).on('value', function(snapshot) {
                console.log(snapshot.val().email);
                //doSomething(snapshot.val().email);
            });
        }

        function createUser() {
            var userEmail = document.getElementById("userEmail").value;
            var userName = document.getElementById("userName").value;
            var pin = document.getElementById("pin").value;

            firebase.auth().createUserWithEmailAndPassword(userEmail, pin);
            firebase.auth().onAuthStateChanged(function(user) {
                if (user && userNotInDb(user)) {
                    // User is signed in.
                    writeUserData(user.uid,userName,userEmail);

                } else {
                    // No user is signed in.
                    alert("nah");
                }
            });
        }

        function logInUser() {
            var userEmail = document.getElementById("userEmail").value;
            var pin = document.getElementById("pin").value;

            firebase.auth().signInWithEmailAndPassword(userEmail, pin);
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // User is signed in.
                    firebase.database().ref('users/' + user.uid).on('value', function(snapshot) {
                        console.log(snapshot.val().email);
                        //doSomething(snapshot.val().email);
                    });
                } else {
                    // No user is signed in.
                    alert("nah");
                }
            });
        }

        function logOutUser(){
            var userEmail = document.getElementById("userEmail").value;
            var pin = document.getElementById("pin").value;

            firebase.auth().signOut().then(function() {
                // Sign-out successful.
            }, function(error) {
                // An error happened.
            });
        }

        function writeUserData(userId, name, email) {
            firebase.database().ref('users/' + userId).set({
                username: name,
                email: email
            });
        }
    </script>
    <title></title>
</head>
<body>

user email: <input type="text" id="userEmail"><br>
user name: <input type="text" id="userName"><br>
Set Pin: <input type="text" id="pin"><br>
<button onClick="createUser()">Create</button>
<button onClick="logInUser()">Log In</button>
<button onclick="logOutUser()">Log Out</button>
</body>
</html>